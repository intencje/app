before_all do
  update_fastlane
end

default_platform(:android)

platform :android do

  desc "Runs all the tests"
  lane :test do
    gradle(task: "test")
  end

  desc "Update app version"
  lane :update_version do
    package = load_json(json_path: "./../package.json")

    android_set_version_name(
      version_name: package["version"]
    )
    android_set_version_code()
  end

  desc "Push a new beta Android build to Firebase App Distribution"
  lane :beta do
    gradle(
      task: "clean bundleRelease",
      print_command: false,
    )
    firebase_app_distribution(
      app: ENV['FIREBASE_ANDROID_APP_ID'],
      groups: "Android",
      release_notes: "Lots of amazing new features to test out!",
  )
  end
end
